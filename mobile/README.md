# Crop Disease Classifier — React Native Mobile App

Offline-first mobile app for crop disease classification. Runs a TFLite model entirely on-device — no internet required.

| Detail | Value |
|--------|-------|
| Model | MobileNetV2 (TFLite) |
| Accuracy | 97.8% |
| Classes | 15 (Corn, Potato, Tomato) |
| Inference | <100ms on-device |
| App size | ~4.5 MB model + ~16 KB data |

---

## Prerequisites

- **Node.js** 18+
- **React Native CLI** (not Expo)
- **Xcode 15+** (iOS) or **Android Studio** (Android)
- **CocoaPods** (iOS): `sudo gem install cocoapods`
- **Python 3.8+** (for model export only)

---

## Step 1: Export the TFLite Model

The app uses a `.tflite` model file for on-device inference. Convert the trained PyTorch model:

```bash
# From the project root (crop-prediction/)
pip install ai-edge-torch torch torchvision

python mobile/scripts/export_model.py
```

This creates `mobile/assets/model/crop_disease_classifier.tflite` (~9 MB FP32 or ~4.5 MB FP16).

> **Note**: The app will not start without this file. You must run the export script first.

---

## Step 2: Install Dependencies

```bash
cd mobile
npm install
```

### iOS Only

```bash
cd ios
pod install
cd ..
```

---

## Step 3: Run the App

### iOS

```bash
npx react-native run-ios
```

Or open `ios/CropDiseaseApp.xcworkspace` in Xcode and press Run.

### Android

```bash
npx react-native run-android
```

Make sure an Android emulator is running or a device is connected via USB.

---

## Step 4: Using the App

1. **Home** — Tap "Scan a Leaf" or navigate to the Scan tab
2. **Camera** — Point at a leaf, position it within the guide circle, tap the capture button
3. **Result** — View the diagnosis: disease name, confidence %, severity, treatment, and prevention tips
4. **History** — All past scans are saved locally for offline access
5. **Library** — Browse all 15 supported diseases with crop filter tabs

---

## Project Structure

```
mobile/
├── App.tsx                              # Entry: SafeAreaProvider → ModelProvider → Navigation
├── index.js                             # AppRegistry
├── package.json                         # Dependencies
├── tsconfig.json                        # TypeScript strict mode
├── babel.config.js                      # Reanimated plugin
├── metro.config.js                      # TFLite asset extension
│
├── assets/
│   ├── model/
│   │   └── crop_disease_classifier.tflite   # TFLite model (generated by export script)
│   └── data/
│       ├── class_names.json                 # 15 class names (from outputs/metrics/)
│       └── disease_info.json                # Disease details: symptoms, treatment, prevention
│
├── src/
│   ├── types/index.ts                   # TypeScript interfaces (Disease, PredictionResult, etc.)
│   │
│   ├── theme/                           # Design system
│   │   ├── colors.ts                    #   Green palette (#2E7D32 primary)
│   │   ├── typography.ts                #   Font sizes and weights
│   │   ├── spacing.ts                   #   4px scale, border radii, shadows
│   │   └── index.ts                     #   Re-exports
│   │
│   ├── services/
│   │   ├── classifier.ts                # TFLite model load, ImageNet preprocessing, inference
│   │   └── storage.ts                   # AsyncStorage CRUD for prediction history
│   │
│   ├── context/
│   │   └── ModelContext.tsx              # React context: loads model on mount, exposes predict()
│   │
│   ├── hooks/
│   │   └── usePrediction.ts             # Hook: capture → predict → save to history
│   │
│   ├── navigation/
│   │   └── AppNavigator.tsx             # Bottom tabs (Home/Scan/History/Library) + Result stack
│   │
│   ├── components/
│   │   ├── ui/                          # Reusable primitives
│   │   │   ├── Card.tsx                 #   Elevated/outlined/filled card
│   │   │   ├── Button.tsx               #   Gradient primary, secondary, outline
│   │   │   ├── Badge.tsx                #   Severity badge (High/Moderate/Healthy)
│   │   │   ├── ConfidenceBar.tsx        #   Animated horizontal progress bar
│   │   │   └── LoadingOverlay.tsx       #   Full-screen spinner
│   │   ├── home/
│   │   │   ├── HeroSection.tsx          #   Green gradient hero with stats
│   │   │   └── FeatureCard.tsx          #   Icon + title + description
│   │   ├── result/
│   │   │   ├── DiagnosisCard.tsx        #   Disease name + confidence + image
│   │   │   ├── TreatmentCard.tsx        #   Treatment with urgency indicator
│   │   │   └── PreventionList.tsx       #   Checkmark list of prevention tips
│   │   └── library/
│   │       └── DiseaseListItem.tsx      #   Expandable disease card with animation
│   │
│   └── screens/
│       ├── HomeScreen.tsx               # Hero + feature cards + scan CTA
│       ├── CameraScreen.tsx             # Camera with leaf guide overlay
│       ├── ResultScreen.tsx             # Full diagnosis result
│       ├── HistoryScreen.tsx            # Past predictions list
│       └── DiseaseLibraryScreen.tsx     # Browsable disease catalog
│
└── scripts/
    └── export_model.py                  # PyTorch .pth → TFLite conversion
```

---

## How It Works (Offline Pipeline)

```
Camera/Gallery → Resize to 224x224 → ImageNet Normalize → TFLite Model → Softmax → Result
                                      (mean/std from       (bundled       (top-5    + Disease
                                       src/config.py)       on-device)    probs)     Info JSON
```

1. **Capture** — Camera captures a leaf photo or user picks from gallery
2. **Preprocess** — Resize to 224x224, convert to RGBA, normalize with ImageNet mean=[0.485, 0.456, 0.406] and std=[0.229, 0.224, 0.225]
3. **Inference** — TFLite model runs on-device using hardware acceleration (CoreML on iOS, GPU delegate on Android)
4. **Postprocess** — Apply softmax to raw logits, extract top-5 predictions
5. **Display** — Match top prediction to `disease_info.json` for symptoms, treatment, and prevention
6. **Save** — Prediction saved to AsyncStorage for offline history

---

## Dependencies

### Runtime

| Package | Purpose |
|---------|---------|
| `react-native-fast-tflite` | On-device TFLite inference with hardware acceleration |
| `react-native-vision-camera` | Camera capture and permissions |
| `react-native-image-picker` | Gallery image selection |
| `react-native-reanimated` | Smooth animations (confidence bars, expand/collapse) |
| `react-native-linear-gradient` | Gradient backgrounds (hero, buttons) |
| `react-native-vector-icons` | Ionicons throughout the UI |
| `@react-navigation/*` | Bottom tabs + stack navigation |
| `@react-native-async-storage` | Local prediction history |
| `react-native-safe-area-context` | Safe area handling |
| `react-native-screens` | Native screen containers |

### Dev

| Package | Purpose |
|---------|---------|
| `typescript` | Type safety (strict mode) |
| `@react-native/babel-preset` | Babel transforms |
| `@react-native/metro-config` | Metro bundler config |
| `@react-native/eslint-config` | Linting rules |
| `jest` | Testing |

---

## Scripts

| Command | Description |
|---------|-------------|
| `npm start` | Start Metro bundler |
| `npm run ios` | Build and run on iOS simulator |
| `npm run android` | Build and run on Android emulator |
| `npm run lint` | Run ESLint on TypeScript files |
| `npm run type-check` | Run TypeScript compiler check |
| `npm test` | Run Jest tests |

---

## Troubleshooting

### Model file not found

```
Error: Cannot find module '../../assets/model/crop_disease_classifier.tflite'
```

Run the export script first:
```bash
python mobile/scripts/export_model.py
```

### Camera permission denied (iOS)

Add to `ios/CropDiseaseApp/Info.plist`:
```xml
<key>NSCameraUsageDescription</key>
<string>We need camera access to scan leaf images for disease detection.</string>
<key>NSPhotoLibraryUsageDescription</key>
<string>We need photo library access to select leaf images for disease detection.</string>
```

### Camera permission denied (Android)

Add to `android/app/src/main/AndroidManifest.xml`:
```xml
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
```

### Pod install fails (iOS)

```bash
cd ios
pod deintegrate
pod install --repo-update
cd ..
```

### Metro bundler cache issues

```bash
npx react-native start --reset-cache
```

---

## Platform-Specific Setup

### iOS

1. Open `ios/CropDiseaseApp.xcworkspace` in Xcode
2. Add `crop_disease_classifier.tflite` to the project (drag into Xcode, check "Copy items if needed")
3. Verify it appears in Build Phases → Copy Bundle Resources
4. Set minimum deployment target to iOS 14.0+

### Android

1. Place `crop_disease_classifier.tflite` in `android/app/src/main/assets/`
2. The Metro config already registers `.tflite` as an asset extension
3. Set `minSdkVersion` to 24+ in `android/app/build.gradle`
